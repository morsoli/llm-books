æœ¬ç”µå­ä¹¦å¼€æºï¼Œæ¬¢è¿ star ğŸŒŸï¼Œå…³æ³¨ã€ŠLLM åº”ç”¨å¼€å‘å®è·µç¬”è®°ã€‹

æˆ‘çš„æ–°ä¹¦[ã€ŠLangChainç¼–ç¨‹ä»å…¥é—¨åˆ°å®è·µã€‹](https://u.jd.com/V8pkqFY) å·²ç»å¼€å”®ï¼æ¨èæ­£åœ¨å­¦ä¹ AIåº”ç”¨å¼€å‘çš„æœ‹å‹è´­ä¹°é˜…è¯»ï¼
[![LangChainç¼–ç¨‹ä»å…¥é—¨åˆ°å®è·µ](../../images/langchain-book.jpg "LangChainç¼–ç¨‹ä»å…¥é—¨åˆ°å®è·µ")](https://u.jd.com/V8pkqFY) 

## Embedding åµŒå…¥
æœ¬èŠ‚å¯¹ Embeddingï¼ˆåµŒå…¥ï¼‰æ¦‚å¿µè¿›è¡Œä»‹ç»ï¼ŒåŒæ—¶ä¼šæåˆ°å‘é‡æ•°æ®åº“ç›¸å…³çŸ¥è¯†ï¼Œæœ‰åŠ©äºåé¢çš„é¡¹ç›®å®ç°ã€‚


### è¯åµŒå…¥æ˜¯ä»€ä¹ˆ
å‘é‡æ˜¯ä¸€ä¸ªæœ‰æ–¹å‘å’Œé•¿åº¦çš„é‡ï¼Œå¯ä»¥ç”¨æ•°å­¦ä¸­çš„åæ ‡æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨äºŒç»´åæ ‡ç³»ä¸­çš„å‘é‡è¡¨ç¤ºä¸€ä¸ªå¹³é¢ä¸Šçš„ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‰ç»´åæ ‡ç³»ä¸­çš„å‘é‡è¡¨ç¤ºä¸€ä¸ªç©ºé—´ä¸­çš„ç‚¹ã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œå‘é‡é€šå¸¸ç”¨äºè¡¨ç¤ºæ•°æ®çš„ç‰¹å¾ã€‚

è€Œè¯åµŒå…¥æ˜¯ä¸€ç§å°†æ–‡æœ¬è¿™ç§ç¦»æ•£æ•°æ®æ˜ å°„åˆ°è¿ç»­å‘é‡ç©ºé—´çš„æ–¹æ³•ï¼ŒåµŒå…¥æŠ€æœ¯å¯ä»¥å°†é«˜ç»´çš„ç¦»æ•£æ•°æ®é™ç»´åˆ°ä½ç»´çš„è¿ç»­ç©ºé—´ä¸­ï¼Œå¹¶ä¿ç•™æ•°æ®ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ï¼Œä»è€Œæ–¹ä¾¿è¿›è¡Œæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ çš„ä»»åŠ¡ã€‚

ä¾‹å¦‚ï¼š  
> "æœºå™¨å­¦ä¹ "è¡¨ç¤ºä¸º [1,2,3]   
 "æ·±åº¦å­¦ä¹ "è¡¨ç¤ºä¸º[2,3,3]  
 "è‹±é›„è”ç›Ÿ"è¡¨ç¤ºä¸º[9,1,3]
>
> ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦æ˜¯ä¸€ç§ç”¨äºè¡¡é‡å‘é‡ä¹‹é—´ç›¸ä¼¼åº¦çš„æŒ‡æ ‡ï¼Œå¯ä»¥ç”¨äºè¯åµŒå…¥ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼‰åœ¨è®¡ç®—æœºä¸­æ¥åˆ¤æ–­æ–‡æœ¬ä¹‹é—´çš„è·ç¦»ï¼š 

> â€œæœºå™¨å­¦ä¹ â€ä¸â€œæ·±åº¦å­¦ä¹ â€çš„è·ç¦»ï¼š![](https://private.codecogs.com/gif.latex?cos%28%5CTheta_1%20%29%3D%5Cfrac%7B1*2+2*3+3*3%7D%7B%5Csqrt%7B1%5E2+2%5E2+3%5E3%7D%5Csqrt%7B2%5E2+3%5E2+3%5E3%7D%7D%3D0.97)
> 
> "æœºå™¨å­¦ä¹ â€ä¸â€œè‹±é›„è”ç›Ÿâ€œçš„è·ç¦»"ï¼š![](https://private.codecogs.com/gif.latex?cos%28%5CTheta_2%20%29%3D%5Cfrac%7B1*9+2*1+3*3%7D%7B%5Csqrt%7B1%5E2+2%5E2+3%5E3%7D%5Csqrt%7B9%5E2+1%5E2+3%5E3%7D%7D%3D0.56)
> 
> â€œæœºå™¨å­¦ä¹ â€ä¸â€œæ·±åº¦å­¦ä¹ â€ä¸¤ä¸ªæ–‡æœ¬ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦æ›´é«˜ï¼Œè¡¨ç¤ºå®ƒä»¬åœ¨è¯­ä¹‰ä¸Šæ›´ç›¸ä¼¼ã€‚

### è¯åµŒå…¥ç®—æ³•
è¯åµŒå…¥ç®—æ³•æ˜¯æŒ‡å°†æ–‡æœ¬æ•°æ®è½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºçš„å…·ä½“ç®—æ³•ï¼Œé€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š
- åˆ†è¯ï¼šå°†æ–‡æœ¬åˆ’åˆ†æˆä¸€ä¸ªä¸ªå•è¯æˆ–çŸ­è¯­ã€‚
- æ„å»ºè¯æ±‡è¡¨ï¼šå°†åˆ†è¯åçš„å•è¯æˆ–çŸ­è¯­å»ºç«‹è¯æ±‡è¡¨ï¼Œå¹¶ä¸ºæ¯ä¸ªå•è¯æˆ–çŸ­è¯­èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ã€‚
- è®¡ç®—è¯åµŒå…¥ï¼šä½¿ç”¨é¢„è®­ç»ƒçš„æ¨¡å‹æˆ–è‡ªè¡Œè®­ç»ƒçš„æ¨¡å‹ï¼Œå°†æ¯ä¸ªå•è¯æˆ–çŸ­è¯­æ˜ å°„åˆ°å‘é‡ç©ºé—´ä¸­ã€‚
- è®¡ç®—è¯åµŒå…¥ï¼šå°†æ–‡æœ¬ä¸­æ¯ä¸ªå•è¯æˆ–çŸ­è¯­çš„å‘é‡è¡¨ç¤ºå–å¹³å‡æˆ–åŠ æƒå¹³å‡ï¼Œå¾—åˆ°æ•´ä¸ªæ–‡æœ¬çš„å‘é‡è¡¨ç¤ºã€‚

å¸¸è§çš„è¯åµŒå…¥ç®—æ³•åŒ…æ‹¬ Word2Vecã€GloVeã€FastText ç­‰ã€‚è¿™äº›ç®—æ³•é€šè¿‡é¢„è®­ç»ƒæˆ–è‡ªè¡Œè®­ç»ƒçš„æ–¹å¼ï¼Œå°†å•è¯æˆ–çŸ­è¯­æ˜ å°„åˆ°ä½ç»´å‘é‡ç©ºé—´ä¸­ï¼Œä»è€Œèƒ½å¤Ÿåœ¨è®¡ç®—æœºä¸­æ–¹ä¾¿åœ°å¤„ç†æ–‡æœ¬æ•°æ®ã€‚
### è¯åµŒå…¥ç”¨é€”
è¯åµŒå…¥ç”¨äºæµ‹é‡æ–‡æœ¬å­—ç¬¦ä¸²çš„ç›¸å…³æ€§ï¼Œé€šå¸¸ç”¨äºï¼š
- æœç´¢ï¼ˆç»“æœæŒ‰ä¸æŸ¥è¯¢å­—ç¬¦ä¸²çš„ç›¸å…³æ€§æ’åºï¼‰
- èšç±»ï¼ˆå…¶ä¸­æ–‡æœ¬å­—ç¬¦ä¸²æŒ‰ç›¸ä¼¼æ€§åˆ†ç»„ï¼‰
- æ¨èï¼ˆæ¨èå…·æœ‰ç›¸å…³æ–‡æœ¬å­—ç¬¦ä¸²çš„é¡¹ç›®ï¼‰
- å¼‚å¸¸æ£€æµ‹ï¼ˆè¯†åˆ«å‡ºç›¸å…³æ€§å¾ˆå°çš„å¼‚å¸¸å€¼ï¼‰
- å¤šæ ·æ€§æµ‹é‡ï¼ˆåˆ†æç›¸ä¼¼æ€§åˆ†å¸ƒï¼‰
- åˆ†ç±»ï¼ˆå…¶ä¸­æ–‡æœ¬å­—ç¬¦ä¸²æŒ‰å…¶æœ€ç›¸ä¼¼çš„æ ‡ç­¾åˆ†ç±»ï¼‰

### ä½¿ç”¨è¯åµŒå…¥æ¨¡å‹
* å¯ä»¥ä½¿ç”¨ HuggingFaceä¸Šèƒ½å¤Ÿå¤„ç†è¯åµŒå…¥çš„å¼€æºæ¨¡å‹ï¼Œä¾‹å¦‚ï¼š[uer/sbert-base-chinese-nli](https://huggingface.co/uer/sbert-base-chinese-nli)
  ```python
  from sentence_transformers import SentenceTransformer
  model = SentenceTransformer('uer/sbert-base-chinese-nli')
  sentences = ["æœºå™¨å­¦ä¹ ","æ·±åº¦å­¦ä¹ ","è‹±é›„è”ç›Ÿ",]
  sentence_embeddings = model.encode(sentences)
  ```

* ä½¿ç”¨ä¹‹å‰ä»‹ç»çš„ [OpenAI è¯åµŒå…¥API](../01-llm/01-3.md#embeddings) å¯ä»¥å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼ŒOpenAI APIæä¾›äº†å¤šä¸ªè¯åµŒå…¥æ¨¡å‹ï¼Œ[è¿™ç¯‡åšå®¢](https://openai.com/blog/new-and-improved-embedding-mode)å¯¹å®ƒä»¬çš„æ€§èƒ½è¿›è¡Œäº†æ¯”è¾ƒï¼Œè¿™é‡Œæ˜¯æ€§èƒ½æœ€å¥½çš„`text-embedding-ada-002`è¯´æ˜ï¼š

|        æ¨¡å‹åç§°        | ä»·æ ¼                  | åˆ†è¯å™¨      | æœ€å¤§è¾“å…¥ token | è¾“å‡º |
| :--------------------: | --------------------- | ----------- | -------------- | ---- |
| text-embedding-ada-002 | $0.000/1k tokens | cl100k_base | 8191           | 1536 |


#### æ”¯æŒè¯åµŒå…¥çš„æ¨¡å‹
  -  [nghuyong/ernie-3.0-nano-zh](https://huggingface.co/nghuyong/ernie-3.0-nano-zh)
  -  [shibing624/text2vec-base-chinese](https://huggingface.co/shibing624/text2vec-base-chinese)
  -  [GanymedeNil/text2vec-large-chinese](https://huggingface.co/GanymedeNil/text2vec-large-chinese)
  -  [moka-ai/m3e-base](https://huggingface.co/moka-ai/m3e-base)
  -  [ç”¨äºå¥å­ã€æ–‡æœ¬å’Œå›¾åƒåµŒå…¥çš„Pythonåº“](https://github.com/UKPLab/sentence-transformers)
### çŸ¢é‡æ•°æ®åº“
* ä¸ºäº†å¿«é€Ÿæœç´¢å¤šä¸ªçŸ¢é‡ï¼Œå»ºè®®ä½¿ç”¨çŸ¢é‡æ•°æ®åº“ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¯é€‰çš„çŸ¢é‡æ•°æ®åº“ï¼š
  - [Pinecone](https://github.com/openai/openai-cookbook/tree/main/examples/vector_databases/pinecone)ï¼Œä¸€ä¸ªå®Œå…¨æ‰˜ç®¡çš„çŸ¢é‡æ•°æ®åº“
  - [Weaviate](https://github.com/openai/openai-cookbook/tree/main/examples/vector_databases/weaviate)ï¼Œä¸€ä¸ªå¼€æºçš„çŸ¢é‡æœç´¢å¼•æ“
  - [Redis](https://github.com/openai/openai-cookbook/tree/main/examples/vector_databases/redis)ä½œä¸ºçŸ¢é‡æ•°æ®åº“
  - [Qdrant](https://github.com/openai/openai-cookbook/tree/main/examples/vector_databases/qdrant)ï¼Œä¸€ä¸ªçŸ¢é‡æœç´¢å¼•æ“
  - [Milvus](https://github.com/openai/openai-cookbook/blob/main/examples/vector_databases/Using_vector_databases_for_embeddings_search.ipynb)ï¼Œä¸€ä¸ªä¸ºå¯æ‰©å±•çš„ç›¸ä¼¼æ€§æœç´¢è€Œæ„å»ºçš„çŸ¢é‡æ•°æ®åº“
  - [Chroma](https://github.com/chroma-core/chroma)ï¼ŒChromaæ˜¯ä¸€ä¸ªå¼€æºçš„åµŒå…¥å¼æ•°æ®åº“ï¼Œå¯ä»¥å¿«é€Ÿæ„å»ºPythonæˆ–JavaScript LLMåº”ç”¨ç¨‹åºã€‚
  - [Typesense](https://typesense.org/docs/0.24.0/api/vector-search.html)ï¼Œå¿«é€Ÿçš„å¼€æºçŸ¢é‡æœç´¢å¼•æ“
  - [Zilliz](https://github.com/openai/openai-cookbook/tree/main/examples/vector_databases/zilliz)ï¼Œæ•°æ®åŸºç¡€è®¾æ–½ï¼Œç”±Milvusæä¾›æŠ€æœ¯æ”¯æŒ
  - [FAISS](https://github.com/facebookresearch/faiss) æ˜¯Metaå¼€æºçš„ç”¨äºé«˜æ•ˆæœç´¢å¤§è§„æ¨¡çŸ¢é‡æ•°æ®é›†çš„åº“

#### æ€§èƒ½ä¼˜åŒ–âœï¸ï¼š
å’Œä¼ ç»Ÿæ•°æ®åº“ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨å·¥ç¨‹æ‰‹æ®µä¼˜åŒ–çŸ¢é‡æ•°æ®åº“æœç´¢æ€§èƒ½ï¼Œæœ€ç›´æ¥çš„å°±æ˜¯æ›´æ–°ç´¢å¼•ç®—æ³• ï¼Œå¯¹ç´¢å¼•æ•°æ®è¿›è¡Œåˆ†åŒºä¼˜åŒ–ã€‚

1. å¹³é¢ç´¢å¼•ï¼ˆFLATï¼‰ï¼šå°†å‘é‡ç®€å•åœ°å­˜å‚¨åœ¨ä¸€ä¸ªå¹³é¢ç»“æ„ä¸­ï¼Œæœ€åŸºæœ¬çš„å‘é‡ç´¢å¼•æ–¹æ³•ã€‚
    - æ¬§å¼è·ç¦»ï¼ˆEuclidean Distanceï¼‰ï¼š{% math %}d(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}{% endmath %}
    - ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰ï¼š{% math %}sim(x,y) = \frac{x \cdot y}{\|x\| \|y\|}{% endmath %}

2. åˆ†åŒºç´¢å¼•ï¼ˆIVFï¼‰ï¼šå°†å‘é‡åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸­ï¼Œæ¯ä¸ªåˆ†åŒºå»ºç«‹ä¸€ä¸ªå€’æ’ç´¢å¼•ç»“æ„ï¼Œæœ€ç»ˆé€šè¿‡å€’æ’ç´¢å¼•å®ç°ç›¸ä¼¼åº¦æœç´¢ã€‚
    - æ¬§å¼è·ç¦»ï¼ˆEuclidean Distanceï¼‰ï¼š{% math %}d(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}{% endmath %}
    - ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰ï¼š{% math %}sim(x,y) = \frac{x \cdot y}{\|x\| \|y\|}{% endmath %}

3. é‡åŒ–ç´¢å¼•ï¼ˆPQï¼‰ï¼šå°†é«˜ç»´å‘é‡åˆ’åˆ†æˆè‹¥å¹²å­å‘é‡ï¼Œå°†æ¯ä¸ªå­å‘é‡é‡åŒ–ä¸ºä¸€ä¸ªç¼–ç ï¼Œæœ€ç»ˆå°†ç¼–ç å­˜å‚¨åœ¨å€’æ’ç´¢å¼•ä¸­ï¼Œåˆ©ç”¨å€’æ’ç´¢å¼•è¿›è¡Œç›¸ä¼¼åº¦æœç´¢ã€‚
    - æ¬§å¼è·ç¦»ï¼ˆEuclidean Distanceï¼‰ï¼š{% math %}d(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}{% endmath %}
    - æ±‰æ˜è·ç¦»ï¼ˆHamming Distanceï¼‰ï¼š{% math %}d(x,y) = \sum_{i=1}^n (x_i \oplus y_i){% endmath %}ï¼Œå…¶ä¸­ {% math %}\oplus{% endmath %} è¡¨ç¤ºæŒ‰ä½å¼‚æˆ–æ“ä½œã€‚

4. HNSW (Hierarchical Navigable Small World)ï¼šé€šè¿‡æ„å»ºä¸€æ£µå±‚æ¬¡åŒ–çš„å›¾ç»“æ„ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„ç›¸ä¼¼åº¦æœç´¢ã€‚
    - å†…ç§¯ï¼ˆInner Productï¼‰ï¼š{% math %}sim(x,y) = x \cdot y{% endmath %}
    - æ¬§å¼è·ç¦»ï¼ˆEuclidean Distanceï¼‰ï¼š{% math %}d(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}{% endmath %}

5. NSG (Navigating Spreading-out Graph)ï¼šé€šè¿‡æ„å»ºä¸€ä¸ªåˆ†å±‚çš„æ— å‘å›¾æ¥å®ç°å¿«é€Ÿçš„ç›¸ä¼¼åº¦æœç´¢ã€‚
    - æ¬§å¼è·ç¦»ï¼ˆEuclidean Distanceï¼‰ï¼š{% math %}d(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}{% endmath %}

6. Annoy (Approximate Nearest Neighbors Oh Yeah)ï¼šé€šè¿‡å°†é«˜ç»´ç©ºé—´çš„å‘é‡æ˜ å°„åˆ°ä½ç»´ç©ºé—´ï¼Œå¹¶æ„å»ºä¸€æ£µäºŒå‰æ ‘æ¥å®ç°é«˜æ•ˆçš„è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ã€‚
    - æ¬§å¼è·ç¦»ï¼ˆEuclidean Distanceï¼‰ï¼š{% math %}d(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}{% endmath %}
    - æ›¼å“ˆé¡¿è·ç¦»ï¼ˆManhattan Distanceï¼‰ï¼š{% math %}d(x,y) = \sum_{i=1}^n |x_i - y_i|{% endmath %}

7. LSH (Locality-Sensitive Hashing)ï¼šé€šè¿‡ä½¿ç”¨å“ˆå¸Œå‡½æ•°å°†é«˜ç»´çš„å‘é‡æ˜ å°„åˆ°ä½ç»´ç©ºé—´ï¼Œå¹¶åœ¨ä½ç»´ç©ºé—´ä¸­æ¯”è¾ƒå“ˆå¸Œæ¡¶ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œå®ç°é«˜æ•ˆçš„ç›¸ä¼¼åº¦æœç´¢ã€‚
    - å†…ç§¯ï¼ˆInner Productï¼‰ï¼š{% math %}sim(x,y) = x \cdot y{% endmath %}
    - æ¬§å¼è·ç¦»ï¼ˆEuclidean Distanceï¼‰ï¼š{% math %}d(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}{% endmath %}

### å‚è€ƒèµ„æº
1. [å‘é‡æ•°æ®åº“æŠ€æœ¯é‰´èµ](https://www.bilibili.com/video/BV1BM4y177Dk/)ï¼šä¸€ä¸ªéå¸¸ä¸é”™çš„è®²è§£å‘é‡æ•°æ®åº“ç§‘æ™®è§†é¢‘